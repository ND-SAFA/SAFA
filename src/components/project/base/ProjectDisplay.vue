<template>
  <panel-card class="full-width mr-2">
    <v-card-title>
      <typography el="h2" variant="subtitle" :value="project.name" />
    </v-card-title>
    <v-card-subtitle>
      <typography variant="caption" :value="version" />
    </v-card-subtitle>
    <v-card-text>
      <typography ep="p" :value="description" />
    </v-card-text>
    <v-card-actions>
      <div>
        <flex-box wrap b="4">
          <div class="mb-2">
            <attribute-chip
              :value="artifacts"
              icon-variant="artifact"
              color="primary"
            />
          </div>
          <div class="mb-2">
            <attribute-chip
              :value="traceLinks"
              icon-variant="trace"
              color="primary"
            />
          </div>
        </flex-box>
        <flex-box
          v-for="direction in typeDirections"
          :key="direction[0]"
          wrap
          y="2"
          align="center"
        >
          <attribute-chip artifact-type :value="direction[0]" />
          <flex-box wrap>
            <icon class="mx-1" variant="trace" />
            <div v-for="type in direction[1]" :key="type" class="mb-1">
              <attribute-chip artifact-type :value="type" />
            </div>
          </flex-box>
        </flex-box>
      </div>
    </v-card-actions>
  </panel-card>
</template>

<script lang="ts">
import { defineComponent } from "vue";
import { versionToString } from "@/util";
import { projectStore, typeOptionsStore } from "@/hooks";
import {
  PanelCard,
  AttributeChip,
  Typography,
  FlexBox,
  Icon,
} from "@/components/common";

/**
 * ProjectDisplay.
 */
export default defineComponent({
  name: "ProjectDisplay",
  components: { Icon, FlexBox, PanelCard, AttributeChip, Typography },
  computed: {
    /**
     * @return The current project.
     */
    project() {
      return projectStore.project;
    },
    /**
     * @return The version for this project.
     */
    version(): string {
      return `Version ${versionToString(this.project.projectVersion)}`;
    },
    /**
     * @return The artifact count for this project.
     */
    artifacts(): string {
      return `${this.project.artifacts.length} Artifacts`;
    },
    /**
     * @return The artifact count for this project.
     */
    traceLinks(): string {
      return `${this.project.traces.length} Trace Links`;
    },
    /**
     * @return The description for this project.
     */
    description(): string {
      return this.project.description || "No Description.";
    },
    /**
     * @return The artifact types for this project.
     */
    artifactTypes(): string[] {
      return typeOptionsStore.artifactTypes;
    },
    /**
     * @return The artifact type directions for this project.
     */
    typeDirections(): [string, string[]][] {
      return Object.values(typeOptionsStore.artifactLevels)
        .map((level) => [level.name, level.allowedTypes] as [string, string[]])
        .filter(([, targets]) => targets.length > 0);
    },
  },
});
</script>
