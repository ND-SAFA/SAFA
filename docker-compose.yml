version: '3.8'

services:
  server:
    container_name: server
    build:
      context: .
      dockerfile: Dockerfile
    env_file: .env
    ports:
    - "4000:80"
    volumes:
    - tgen-volume:/vol
    networks:
    - app_network
    depends_on:
    - rabbitmq
    environment:
    - BROKER_URL=amqp://guest:guest@rabbitmq/tgen_vhost
    - BROKER_USERNAME=guest
    - BROKER_PASSWORD=guest

  rabbitmq:
    container_name: rabbitmq
    image: "rabbitmq:3-management"
    hostname: rabbitmq
    environment:
    - RABBITMQ_DEFAULT_VHOST=tgen_vhost
    - RABBITMQ_DEFAULT_USER=guest
    - RABBITMQ_DEFAULT_PASS=guest
    ports:
    - "5672:5672" # RabbitMQ
    - "15672:15672" # Management interface
    networks:
    - app_network

networks:
  app_network:

volumes:
  tgen-volume:
    name: tgen-volume
